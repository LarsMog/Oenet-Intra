<?php/** * @version    CVS: 1.0.0 * @package    Com_Larsmog_events * @author     Webitall Aps <home@webitall.dk> * @copyright  2016 Webitall Aps * @license    GNU General Public License version 2 or later; see LICENSE.txt */// No direct accessdefined('_JEXEC') or die;JHtml::addIncludePath(JPATH_COMPONENT . '/helpers/html');$week = JFactory::getApplication()->input->getInt('week');if( $week==0 ) {	$week = (int)date('W',time());}$time = strtotime("1 January ".date('Y'), time());$day = date('w', $time);$time += ((7*$week)+1-$day)*24*3600;$days = array();$days[1] = date('Y-m-d', $time);for( $i=2 ; $i<=7 ; $i++ ){	$days[$i] = date('Y-m-d', strtotime(date('Y-m-d',$time). ' + '.($i-1).' days'));}$weekdays = array('','Mandag', 'Tirsdag', 'Onsdag', 'Torsdag', 'Fredag', 'Lørdag', 'Søndag');$months = array('', 'januar', 'februar', 'marts', 'april', 'maj', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'december' );//var_dump( $this->persons );?><div class="row" style="margin-right:6px;">    <div class="col-lg-1 col-md-1 col-sm-2 col-xs-2">        <img src="/images/enhedslisten_logo.jpg" class="img-responsive img-circle filterImage" id="filterImage0" onclick="changePerson(0)" style="cursor:pointer;border: 2px solid #cc071e"             data-toggle="tooltip"  title="Vis alle">        <div style="text-align: center"><small>Vis alle</small></div>    </div>    <?php foreach( $this->persons AS $person ) : ?>        <div class="col-lg-1 col-md-1 col-sm-2 col-xs-2">		    <?php $user=JUserHelper::getProfile($person->id); ?>            <img src="<?php echo $user->profile['picture']; ?>" class="img-responsive img-circle filterImage" onclick="changePerson(<?php echo $person->id;?>)" style="cursor:pointer;border: 1px solid #e8e6e6"                 id="filterImage<?php echo $person->id;?>" data-toggle="tooltip" title="Vis <?php echo $person->name;?>">            <div style="text-align: center"><small><?php echo $person->name;?></small></div>        </div>    <?php endforeach; ?></div><br><div class="row" style="margin-right:6px;">	<div class="col-md-2">		<?php if( $week>=2 ) : ?>			<a href="index.php?option=com_intra&view=events&layout=week&week=<?php echo (int)($week-1); ?>" class="btn btn-primary btn-lg"><i class="fa fa-arrow-left" aria-hidden="true"></i> uge <?php echo (int)($week-1); ?></a>		<?php endif; ?>	</div>	<div class="col-md-10">		<h2 style="text-align: center">Uge <?php echo $week; ?></h2>	</div>	<div class="col-md-2">		<?php if( $week<=51 ) : ?>			<a href="index.php?option=com_intra&view=events&layout=week&week=<?php echo (int)($week+1); ?>" class="btn btn-primary pull-right btn-lg">uge <?php echo (int)($week+1); ?> <i class="fa fa-arrow-right" aria-hidden="true"></i> </a>		<?php endif; ?>	</div></div><br><div class="row" style="margin-right:6px;">	<?php for( $d=1 ; $d<=7 ; $d++ ) : ?>		<div class="col-md-2">			<div class="well" style="margin-bottom: 8px"><b><?php echo $weekdays[$d]; ?></b><br><?php echo date('d.', strtotime($days[$d])); ?> <?php echo $months[(int)date('n',strtotime($days[$d]))];?></div>			<?php   if( $this->events[$days[$d]]) : ?>				<?php foreach( $this->events[$days[$d]] AS $event  ) : ?>                    <?php if( $event->participants ) { $participants = explode(',',$event->participants); } else { $participants = array(); } ?>                    <?php $link = JRoute::_('index.php?option=com_intra&view=event&id='.$event->id); ?>                    <?php $class=''; foreach( $participants AS $pId ) { $class .= ' person'.$pId; } ?>		            <div class="panel eventbox panel-success<?php echo $class;?>" style="margin-bottom: 8px;cursor:pointer;" onclick="window.location='<?php echo $link; ?>'">						<div class="panel-heading"><?php echo $event->time_start;?>                            <?php if( strlen( $event->time_end ) > 0 ) : ?>                                - <?php echo  $event->time_end; ?>                            <?php endif; ?>                        </div>						<div class="panel-body">							<b><?php echo $event->name; ?></b><small style="display:inline-block; line-height:12px">                            <?php                            $parts = preg_split('/([\s\n\r]+)/', $event->description, null, PREG_SPLIT_DELIM_CAPTURE);                            $parts_count = count($parts);                            $length = 0;                            $last_part = 0;                            $split = false;                            for (; $last_part < $parts_count; ++$last_part) {	                            $length += strlen($parts[$last_part]);	                            if ($length > 50) { $split = true; break; }                            }                            echo implode(array_slice($parts, 0, $last_part));                            if( $split ) { echo '...'; }                            ?></small>                            <div class="row-fluid">                                <?php foreach( $participants AS $person ) : ?>                                    <div class="col-lg-4 col-md-6 col-sm-2 col-xs-2">                                        <?php $user=JUserHelper::getProfile($person); ?>                                        <img src="<?php echo $user->profile['picture']?$user->profile['picture']:'/images/enhedslisten_logo.jpg'; ?>" class="img-responsive img-circle"                                             data-toggle="tooltip" style="border: 1px solid #e8e6e6" title="<?php echo JFactory::getUser($person)->name;?>">                                    </div>                                <?php endforeach; ?>                            </div>						</div>					</div>				<?php endforeach; ?>			<?php endif; ?>		</div>	<?php endfor; ?></div><?php if( JFactory::getUser()->id > 0 ) : ?>	<a href="<?php echo JRoute::_('index.php?option=com_intra&task=eventform.edit&id=0', false, 2); ?>" class="btn btn-success btn-small">		<i class="icon-plus"></i> Opret ny</a><?php endif; ?><script>    function changePerson( id ) {        jQuery('.filterImage').css('border','1px solid #e8e6e6');        jQuery('#filterImage'+id).css('border','2px solid #cc071e');        if( id>0 ) {            jQuery('.eventbox').hide();            jQuery('.person'+id).show();        } else {            jQuery('.eventbox').show();        }    }</script>